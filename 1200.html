


<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>單字複習網站</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">
  <style>
    :root {
      --bg-color: #fff;
      --text-color: #222;
      --accent-color: #007bff;
      --card-bg: #f7f7f7;
      --border-color: #ccc;
      --decoration: none;
      --main-radius: 18px;
      --main-shadow: 0 4px 24px #0001;
      --main-font-size: 1em;
      --main-line-height: 1.6;
      --container-width: 520px;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-size: var(--main-font-size);
      line-height: var(--main-line-height);
      background: var(--bg-color);
      color: var(--text-color);
      font-family: 'Segoe UI', '微軟正黑體', Arial, sans-serif;
      overflow: hidden;
    }
    body {
      min-height: 100vh;
      min-width: 100vw;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }
    .theme-switcher {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      padding: 1em 0 0.5em 0;
    }
    .theme-switcher button {
  padding: 0.5em 1.3em;
  border: none;
  border-radius: 25px;
  background: var(--card-bg);
  color: var(--accent-color);
  font-size: 1em;
  cursor: pointer;
  box-shadow: 0 2px 8px #0001;
  transition: background 0.3s, color 0.3s, box-shadow 0.3s, transform 0.18s;
  touch-action: manipulation;
  font-weight: 600;
  outline: none;
  position: relative;
  overflow: hidden;
  min-width: 44px;
  min-height: 44px;
}
    .theme-switcher button:active,
    .theme-switcher button:focus {
      outline: 2px solid var(--accent-color);
      transform: scale(0.97);
    }
    .theme-switcher button:hover {
      background: var(--accent-color);
      color: #fff;
      box-shadow: 0 4px 16px #0002;
      transform: scale(1.04);
    }
    .container {
      width: var(--container-width);
      max-width: 94vw;
      margin: 0 auto;
      background: var(--card-bg);
      border-radius: var(--main-radius);
      box-shadow: var(--main-shadow);
      padding: 2em 2em 1em 2em;
      border: 2px solid var(--border-color);
      position: relative;
      z-index: 1;
      overflow: visible;
      font-size: 1em;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 70vh;
      max-height: 85vh;
    }
    h1 {
      margin-top: 0;
      margin-bottom: 0.5em;
      font-size: 2em;
      letter-spacing: 2px;
      text-align: center;
      color: var(--accent-color);
      font-weight: 800;
      line-height: 1.2;
      text-shadow: 0 2px 8px #0001;
    }
    .decoration {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none;
      z-index: 0;
      background: var(--decoration);
      opacity: 0.16;
    }
    .upload-section, .practice-section, .review-section {
      position: relative;
      z-index: 1;
      margin-bottom: 1.2em;
      width: 100%;
    }
    .upload-section label {
      font-size: 1em;
      font-weight: 600;
    }
    .upload-section input[type="file"] {
      margin-bottom: 0.5em;
      font-size: 1em;
      padding: 0.5em;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: #fff;
    }
  .drag-area {
  border: 2px dashed var(--accent-color);
  border-radius: 15px;
  padding: 1.2em 1.5em;
  text-align: center;
  color: var(--accent-color);
  background: #fff4;
  margin-bottom: 0.7em;
  font-size: 1em;
  transition: background 0.3s, border-color 0.3s, transform 0.2s;
  user-select: none;
  font-weight: 600;
  cursor: pointer;
  min-height: 80px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.drag-area.dragover {
  background: #e0f7fa;
  border-color: #00bcd4;
  transform: scale(1.02);
  box-shadow: 0 8px 24px rgba(0, 188, 212, 0.2);
}
    .btn {
      padding: 0.5em 1.2em;
      border-radius: 20px;
      border: none;
      background: var(--accent-color);
      color: #fff;
      font-size: 1em;
      cursor: pointer;
      margin-right: 0.5em;
      margin-top: 0.5em;
      transition: background 0.3s, transform 0.18s;
      touch-action: manipulation;
      font-weight: 700;
      outline: none;
      box-shadow: 0 2px 8px #0001;
    }
    .btn:active, .btn:focus {
      outline: 2px solid #fff;
      transform: scale(0.97);
    }
    .btn:hover {
      background: #333;
      color: #fff;
      transform: scale(1.04);
    }
    .error {
      color: #d72660;
      font-weight: bold;
      margin-top: 0.5em;
      font-size: 1em;
    }
    .practice-section {
      text-align: center;
      width: 100%;
    }
    .practice-section input[type="text"] {
      padding: 0.5em;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      margin-right: 0.5em;
      width: 60%;
      max-width: 220px;
      box-sizing: border-box;
      touch-action: manipulation;
      font-weight: 600;
      background: #fff;
      letter-spacing: 0.05em;
    }
    .practice-stats {
      font-size: 1em;
      margin-bottom: 0.5em;
      display: flex;
      justify-content: center;
      gap: 1.2em;
      flex-wrap: wrap;
    }
    .practice-stats span {
      background: #fff6;
      border-radius: 8px;
      padding: 0.2em 0.7em;
      color: var(--accent-color);
      font-weight: bold;
      min-width: 62px;
      display: inline-block;
      font-size: 1em;
      box-shadow: 0 2px 8px #0001;
    }
    .result {
      font-weight: bold;
      margin-top: 1em;
      min-height: 1.5em;
      font-size: 1em;
    }
    .correct {
      color: #1bbf2b;
    }
    .incorrect {
      color: #d72660;
    }
    .review-section {
      background: #fff8;
      border-radius: 12px;
      padding: 1em;
      margin-top: 1.2em;
      border: 1px dashed var(--accent-color);
      text-align: center;
      box-shadow: 0 2px 12px #0001;
      width: 100%;
    }
    .review-section h2 {
      margin-top: 0;
      font-size: 1.08em;
      color: var(--accent-color);
      font-weight: 700;
    }
    .review-section ul {
      padding-left: 1.2em;
      text-align: left;
      display: inline-block;
      font-size: 1em;
      max-height: 22vh;
      overflow-y: auto;
    }
    .range-section {
      margin: 1em 0 1.2em 0;
      text-align: center;
      width: 100%;
    }
    .range-section input[type="number"] {
      width: 60px;
      padding: 0.4em;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      margin: 0 0.25em;
      text-align: center;
      touch-action: manipulation;
    }
    .order-section {
      margin: 1em 0 1.2em 0;
      text-align: center;
      font-size: 1em;
      font-weight: 600;
      width: 100%;
    }
    .order-section label {
      margin-right: 0.7em;
    }
    .order-radio {
      margin: 0 0.7em;
      accent-color: var(--accent-color);
      width: 1em;
      height: 1em;
      vertical-align: middle;
      touch-action: manipulation;
    }
    .pronounce-btn {
      background: none;
      border: none;
      cursor: pointer;
      vertical-align: middle;
      margin-left: 0.3em;
      outline: none;
      padding: 0;
      touch-action: manipulation;
    }
    .pronounce-btn svg {
      width: 1.5em;
      height: 1.5em;
      fill: var(--accent-color);
      transition: fill 0.2s;
      vertical-align: middle;
    }
    .pronounce-btn:hover svg, .pronounce-btn:active svg {
      fill: #ff4081;
    }
    @media (max-width: 768px) {
      :root { --container-width: 99vw; }
      .container {
        padding: 1em 0.4em 0.7em 0.4em;
        min-height: 97vh;
        max-height: 99vh;
      }
      .practice-section input[type="text"] {
        width: 96%;
        font-size: 1em;
      }
      .btn, .theme-switcher button {
  font-size: 0.9em;
  padding: 0.5em 0.8em;
  min-width: 44px;
  min-height: 44px;
}
      .practice-stats span {
        font-size: 0.98em;
        min-width: 45px;
        padding: 0.15em 0.3em;
      }
      .review-section ul {
        font-size: 0.98em;
      }
      h1 { font-size: 1.3em; }
    }
    /* 主題樣式 */
  /* 主題樣式 - 優化版本 */

/* 星空探險 - 深藍紫色調 */
.theme-star {
  --bg-color: #0a0f1e;
  --text-color: #ffffff;
  --accent-color: #ffd700;
  --card-bg: #1a1f35;
  --border-color: #ffd700;
  --decoration: 
    radial-gradient(circle at 15% 25%, #ffffff 1px, transparent 2px),
    radial-gradient(circle at 85% 15%, #ffffff 0.5px, transparent 1px),
    radial-gradient(circle at 25% 75%, #ffffff 1.5px, transparent 2px),
    radial-gradient(circle at 75% 85%, #ffffff 0.8px, transparent 1px),
    radial-gradient(circle at 45% 35%, #ffffff 0.3px, transparent 1px),
    radial-gradient(circle at 65% 65%, #ffffff 1px, transparent 1.5px),
    radial-gradient(ellipse at 50% 30%, #4169e155 0%, transparent 70%),
    url('data:image/svg+xml;utf8,<svg width="200" height="200" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg"><polygon points="100,20 105,35 120,35 108,45 113,60 100,50 87,60 92,45 80,35 95,35" fill="%23ffd700" opacity="0.3"/><polygon points="50,80 53,87 60,87 55,91 57,98 50,94 43,98 45,91 40,87 47,87" fill="%23ffffff" opacity="0.4"/><polygon points="150,120 153,127 160,127 155,131 157,138 150,134 143,138 145,131 140,127 147,127" fill="%23ffd700" opacity="0.25"/><circle cx="30" cy="40" r="2" fill="%23ffffff" opacity="0.6"/><circle cx="170" cy="70" r="1.5" fill="%23ffffff" opacity="0.7"/></svg>'),
    linear-gradient(135deg, #0a0f1e 0%, #1a1f35 50%, #0a0f1e 100%);
}

/* 海底世界 - 深海藍綠色調 */
.theme-ocean {
  --bg-color: #001a2e;
  --text-color: #e0f7ff;
  --accent-color: #00ffff;
  --card-bg: #003d5b;
  --border-color: #00bcd4;
  --decoration: 
    radial-gradient(ellipse at 20% 80%, #00ffff22 0%, transparent 60%),
    radial-gradient(ellipse at 80% 20%, #0080b355 0%, transparent 70%),
    radial-gradient(circle at 60% 40%, #006994 0 40px, transparent 80px),
    repeating-linear-gradient(45deg, 
      transparent 0px, 
      transparent 40px, 
      #00bcd433 40px, 
      #00bcd433 42px),
    url('data:image/svg+xml;utf8,<svg width="150" height="150" viewBox="0 0 150 150" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M30 60 Q40 50, 50 60 Q60 70, 70 60 Q80 50, 90 60" stroke="%2300bcd4" stroke-width="2" fill="none" opacity="0.3"/><path d="M20 100 Q35 90, 50 100 Q65 110, 80 100 Q95 90, 110 100" stroke="%2300ffff" stroke-width="1.5" fill="none" opacity="0.4"/><ellipse cx="40" cy="30" rx="15" ry="8" fill="%2300bcd4" opacity="0.2"/><ellipse cx="100" cy="120" rx="20" ry="10" fill="%2300ffff" opacity="0.15"/><circle cx="120" cy="40" r="3" fill="%2300ffff" opacity="0.5"/><circle cx="25" cy="130" r="2" fill="%2300bcd4" opacity="0.6"/></svg>'),
    linear-gradient(180deg, #001a2e 0%, #003d5b 30%, #002d45 70%, #001a2e 100%);
}

/* 糖果樂園 - 粉紅甜美色調 */
.theme-candy {
  --bg-color: #ffeef7;
  --text-color: #c2185b;
  --accent-color: #e91e63;
  --card-bg: #ffffff;
  --border-color: #f48fb1;
  --decoration: 
    radial-gradient(circle at 25% 25%, #ff69b4aa 0 30px, transparent 50px),
    radial-gradient(circle at 75% 75%, #ff1493aa 0 25px, transparent 45px),
    radial-gradient(circle at 15% 85%, #ffc0cbaa 0 35px, transparent 60px),
    radial-gradient(circle at 85% 15%, #ffb6c1aa 0 20px, transparent 40px),
    url('data:image/svg+xml;utf8,<svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="30" cy="30" r="12" fill="%23ff69b4" opacity="0.3"/><circle cx="90" cy="30" r="8" fill="%23ff1493" opacity="0.4"/><circle cx="30" cy="90" r="10" fill="%23ffc0cb" opacity="0.3"/><circle cx="90" cy="90" r="14" fill="%23ffb6c1" opacity="0.25"/><path d="M60 20 L65 30 L75 30 L67 38 L70 48 L60 42 L50 48 L53 38 L45 30 L55 30 Z" fill="%23ff69b4" opacity="0.3"/><ellipse cx="60" cy="80" rx="20" ry="8" fill="%23f48fb1" opacity="0.2"/></svg>'),
    linear-gradient(45deg, #ffeef7 0%, #fff0f5 50%, #ffeef7 100%);
}

/* 魔法學院 - 深紫神秘色調 */
.theme-magic {
  --bg-color: #1a0d33;
  --text-color: #e6d9ff;
  --accent-color: #9c27b0;
  --card-bg: #2d1b4e;
  --border-color: #ab47bc;
  --decoration: 
    radial-gradient(ellipse at 30% 70%, #9c27b044 0%, transparent 60%),
    radial-gradient(ellipse at 70% 30%, #673ab777 0%, transparent 50%),
    radial-gradient(circle at 50% 20%, #3f51b533 0 60px, transparent 100px),
    url('data:image/svg+xml;utf8,<svg width="160" height="160" viewBox="0 0 160 160" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M40 40 L50 60 L70 50 L60 70 L80 80 L60 90 L70 110 L50 100 L40 120 L30 100 L10 110 L20 90 L0 80 L20 70 L10 50 L30 60 Z" fill="%239c27b0" opacity="0.25"/><circle cx="120" cy="40" r="8" fill="%23ab47bc" opacity="0.3"/><path d="M120 100 Q130 90, 140 100 Q130 110, 120 100" fill="%23673ab7" opacity="0.4"/><ellipse cx="40" cy="120" rx="15" ry="6" fill="%239c27b0" opacity="0.2"/><polygon points="100,20 105,30 115,30 107,37 110,47 100,42 90,47 93,37 85,30 95,30" fill="%23ab47bc" opacity="0.3"/></svg>'),
    linear-gradient(225deg, #1a0d33 0%, #2d1b4e 40%, #1a0d33 100%);
}

/* 冰雪王國 - 冰藍清冷色調 */
.theme-ice {
  --bg-color: #e8f4fd;
  --text-color: #01579b;
  --accent-color: #0277bd;
  --card-bg: #ffffff;
  --border-color: #29b6f6;
  --decoration: 
    radial-gradient(circle at 40% 30%, #81d4fa55 0 50px, transparent 80px),
    radial-gradient(circle at 70% 70%, #b3e5fc44 0 40px, transparent 70px),
    radial-gradient(circle at 20% 80%, #e1f5fe66 0 60px, transparent 90px),
    url('data:image/svg+xml;utf8,<svg width="140" height="140" viewBox="0 0 140 140" fill="none" xmlns="http://www.w3.org/2000/svg"><polygon points="70,10 75,25 90,30 75,35 70,50 65,35 50,30 65,25" fill="%2329b6f6" opacity="0.3"/><polygon points="30,60 32,65 37,67 32,69 30,74 28,69 23,67 28,65" fill="%2381d4fa" opacity="0.4"/><polygon points="110,90 113,97 120,99 113,101 110,108 107,101 100,99 107,97" fill="%23b3e5fc" opacity="0.35"/><path d="M20 20 L30 25 L25 35 L20 30 L10 35 L15 25 Z" fill="%230277bd" opacity="0.25"/><path d="M120 20 L125 30 L135 25 L130 35 L125 40 L120 35 L110 40 L115 30 Z" fill="%2329b6f6" opacity="0.3"/></svg>'),
    linear-gradient(135deg, #e8f4fd 0%, #ffffff 50%, #f0f8ff 100%);
}

/* 賽博龐克 - 霓虹科技色調 */
.theme-cyber {
  --bg-color: #0d1117;
  --text-color: #00ff88;
  --accent-color: #ff0080;
  --card-bg: #161925;
  --border-color: #00ffaa;
  --decoration: 
    repeating-linear-gradient(90deg, 
      transparent 0px, 
      transparent 98px, 
      #ff008022 100px, 
      #ff008022 102px),
    repeating-linear-gradient(0deg, 
      transparent 0px, 
      transparent 98px, 
      #00ff8822 100px, 
      #00ff8822 102px),
    radial-gradient(ellipse at 25% 75%, #ff008033 0%, transparent 60%),
    radial-gradient(ellipse at 75% 25%, #00ff8833 0%, transparent 60%),
    url('data:image/svg+xml;utf8,<svg width="180" height="180" viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="20" y="20" width="30" height="4" fill="%23ff0080" opacity="0.6"/><rect x="130" y="40" width="25" height="3" fill="%2300ff88" opacity="0.5"/><rect x="40" y="80" width="35" height="2" fill="%23ff0080" opacity="0.4"/><rect x="100" y="120" width="40" height="3" fill="%2300ff88" opacity="0.6"/><circle cx="60" cy="140" r="3" fill="%23ff0080" opacity="0.7"/><circle cx="140" cy="60" r="2" fill="%2300ff88" opacity="0.8"/><polygon points="80,30 85,35 90,30 85,25" fill="%23ff0080" opacity="0.4"/><polygon points="120,150 125,155 130,150 125,145" fill="%2300ff88" opacity="0.5"/></svg>'),
    linear-gradient(135deg, #0d1117 0%, #161925 30%, #0d1117 70%, #1a1d29 100%);
}

/* 叢林冒險 - 深綠自然色調 */
.theme-jungle {
  --bg-color: #1b4332;
  --text-color: #d8f3dc;
  --accent-color: #52b788;
  --card-bg: #2d5a3d;
  --border-color: #74c69d;
  --decoration: 
    radial-gradient(ellipse at 20% 30%, #52b78855 0%, transparent 70%),
    radial-gradient(ellipse at 80% 70%, #40916c44 0%, transparent 60%),
    radial-gradient(circle at 60% 20%, #2d5a3d 0 30px, transparent 60px),
    radial-gradient(circle at 30% 80%, #1b4332 0 40px, transparent 70px),
    url('data:image/svg+xml;utf8,<svg width="160" height="160" viewBox="0 0 160 160" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="40" cy="30" rx="25" ry="12" fill="%2352b788" opacity="0.3"/><ellipse cx="100" cy="60" rx="20" ry="8" fill="%2374c69d" opacity="0.4"/><ellipse cx="30" cy="100" rx="30" ry="15" fill="%2340916c" opacity="0.25"/><ellipse cx="120" cy="120" rx="18" ry="10" fill="%2352b788" opacity="0.35"/><path d="M60 40 Q70 30, 80 40 Q90 50, 100 40 Q110 30, 120 40" stroke="%2374c69d" stroke-width="3" fill="none" opacity="0.3"/><path d="M20 80 Q30 70, 40 80 Q50 90, 60 80" stroke="%2352b788" stroke-width="2" fill="none" opacity="0.4"/><circle cx="80" cy="100" r="4" fill="%2374c69d" opacity="0.5"/><circle cx="140" cy="40" r="3" fill="%2352b788" opacity="0.6"/></svg>'),
    linear-gradient(60deg, #1b4332 0%, #2d5a3d 50%, #1b4332 100%);
  </style>
</head>
<body>
  <div class="theme-switcher">
    <button onclick="setTheme('star')">星空探險</button>
    <button onclick="setTheme('ocean')">海底世界</button>
    <button onclick="setTheme('candy')">糖果樂園</button>
    <button onclick="setTheme('magic')">魔法學院</button>
    <button onclick="setTheme('ice')">冰雪王國</button>
    <button onclick="setTheme('cyber')">賽博龐克</button>
    <button onclick="setTheme('jungle')">叢林冒險</button>
  </div>
  <div class="container">
    <div class="decoration"></div>
    <h1>單字複習網站</h1>
<div class="upload-section">
  <input type="file" id="csvFile" accept=".csv" style="display: none;">
  <div class="drag-area" id="dragArea">
    <div style="font-size: 1em; margin-bottom: 0.5em;">📁 選擇或拖曳CSV檔案</div>

    <button class="btn" onclick="document.getElementById('csvFile').click()" 
            style="background: var(--accent-color); margin-bottom: 0.5em;">選擇檔案</button>
    <button class="btn" onclick="useSample()" 
            style="background: #28a745; margin-top: 0.5em;">使用範例單字庫</button>
  </div>
  <div id="uploadError" class="error"></div>
</div>
    <div class="range-section" id="rangeSection" style="display:none;">
      <label>練習範圍：</label>
      <input type="number" id="rangeStart" min="1" value="1"> ~
      <input type="number" id="rangeEnd" min="1" value="1">
      <button class="btn" onclick="startPracticeWithRange()">開始練習</button>
    </div>
    <div class="order-section" id="orderSection" style="display:none;">
      <label>練習順序：</label>
      <input class="order-radio" type="radio" name="order" id="orderRandom" value="random" checked>
      <label for="orderRandom">隨機</label>
      <input class="order-radio" type="radio" name="order" id="orderAsc" value="asc">
      <label for="orderAsc">正序</label>
      <input class="order-radio" type="radio" name="order" id="orderDesc" value="desc">
      <label for="orderDesc">倒序</label>
    </div>
    <div class="practice-section" style="display:none;">
      <div class="practice-stats" id="practiceStats">
        <span>總題數: 0</span>
        <span>正確: 0</span>
        <span>錯誤: 0</span>
      </div>
      <div id="wordProgress"></div>
      <div id="wordQuestion" style="font-size:1.1em; margin-bottom:0.6em;"></div>
      <input type="text" id="answerInput" autocomplete="off" placeholder="請輸入英文單字">
      <button class="btn" onclick="checkAnswer()">送出</button>
      <div class="result" id="resultMsg"></div>
    </div>
    <div class="review-section" style="display:none;">
      <h2>以下是您答錯的單字，可以針對這些單字進行複習：</h2>
<button class="btn" id="exportWrongBtn">匯出錯誤單字CSV</button>
        <button class="btn" id="retryWrongBtn">針對錯誤單字重新練習</button>
      <ul id="wrongList"></ul>
      <div style="margin-top:1.2em;">
        
      </div>
    </div>
  </div>
  <script>
    // 主題切換
    function setTheme(theme) {
      document.documentElement.className = 'theme-' + theme;
      localStorage.setItem('theme', theme);
    }
    window.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('theme') || 'star';
      setTheme(saved);
    });

    // 單字複習功能
    let fullWordList = [];
    let wordList = [];
    let current = 0;
    let wrongWords = [];
    let correctCount = 0;
    let wrongCount = 0;
    let totalCount = 0;
    const csvFile = document.getElementById('csvFile');
    const uploadError = document.getElementById('uploadError');
    const practiceSection = document.querySelector('.practice-section');
    const reviewSection = document.querySelector('.review-section');
    const wordQuestion = document.getElementById('wordQuestion');
    const answerInput = document.getElementById('answerInput');
    const resultMsg = document.getElementById('resultMsg');
    const wordProgress = document.getElementById('wordProgress');
    const wrongList = document.getElementById('wrongList');
    const dragArea = document.getElementById('dragArea');
    const rangeSection = document.getElementById('rangeSection');
    const rangeStart = document.getElementById('rangeStart');
    const rangeEnd = document.getElementById('rangeEnd');
    const orderSection = document.getElementById('orderSection');
    const practiceStats = document.getElementById('practiceStats');
    let lastWrongWords = [];

    // 拖曳上傳
    dragArea.addEventListener('dragover', function(e){
      e.preventDefault();
      dragArea.classList.add('dragover');
    });
    dragArea.addEventListener('dragleave', function(e){
      e.preventDefault();
      dragArea.classList.remove('dragover');
    });
    dragArea.addEventListener('drop', function(e){
      e.preventDefault();
      dragArea.classList.remove('dragover');
      if (e.dataTransfer.files.length) {
        const file = e.dataTransfer.files[0];
        if (file.name.endsWith('.csv')) {
          const reader = new FileReader();
          reader.onload = function(e) {
            parseCSV(e.target.result);
          };
          reader.readAsText(file, 'utf-8');
        } else {
          uploadError.textContent = "請上傳副檔名為 .csv 的檔案";
        }
      }
    });

    csvFile.addEventListener('change', function() {
      if (!this.files.length) return;
      const file = this.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        parseCSV(e.target.result);
      };
      reader.readAsText(file, 'utf-8');
    });

    function parseCSV(text) {
      const lines = text.trim().split('\n').filter(Boolean);
      const parsed = [];
      for (let line of lines) {
        line = line.replace(/\r/g, '');
        const cols = line.split(',');
        if (cols.length < 3) continue;
        parsed.push({
          num: cols[0].trim(),
          en: cols[1].trim(),
          zh: cols[2].trim()
        });
      }
      if (parsed.length === 0) {
        uploadError.textContent = "CSV 檔案格式不正確，請確保檔案包含序號、英文單字和中文意思三個欄位。";
        return;
      }
      uploadError.textContent = "";
      fullWordList = parsed;
      showRangeSelector();
    }

    function useSample() {
      const sample = [
        {num:"1", en:"apple", zh:"蘋果"},
        {num:"2", en:"banana", zh:"香蕉"},
        {num:"3", en:"cat", zh:"貓"},
        {num:"4", en:"dog", zh:"狗"},
        {num:"5", en:"elephant", zh:"大象"},
        {num:"6", en:"fish", zh:"魚"},
        {num:"7", en:"grape", zh:"葡萄"},
        {num:"8", en:"hat", zh:"帽子"},
        {num:"9", en:"ice", zh:"冰"},
        {num:"10", en:"juice", zh:"果汁"}
      ];
      fullWordList = sample;
      showRangeSelector();
    }

    function showRangeSelector() {
      rangeSection.style.display = "";
      orderSection.style.display = "";
      practiceSection.style.display = "none";
      reviewSection.style.display = "none";
      let min = 1, max = 1;
      if (fullWordList.length > 0) {
        min = Number(fullWordList[0].num) || 1;
        max = Number(fullWordList[fullWordList.length-1].num) || fullWordList.length;
      }
      rangeStart.value = min;
      rangeEnd.value = max;
      rangeStart.min = min;
      rangeEnd.min = min;
      rangeStart.max = max;
      rangeEnd.max = max;
    }

    function getOrderType() {
      const radios = document.getElementsByName('order');
      for (let r of radios) {
        if (r.checked) return r.value;
      }
      return "random";
    }

    function startPracticeWithRange() {
      let start = parseInt(rangeStart.value, 10);
      let end = parseInt(rangeEnd.value, 10);
      if (isNaN(start) || isNaN(end) || start > end) {
        uploadError.textContent = "請輸入正確的練習範圍（起始值需小於等於結束值）";
        return;
      }
      let filtered = fullWordList.filter(w => {
        const n = parseInt(w.num, 10);
        return !isNaN(n) && n >= start && n <= end;
      });
      if (filtered.length === 0) {
        uploadError.textContent = "該範圍內沒有單字，請重新設定。";
        return;
      }
      uploadError.textContent = "";
      const orderType = getOrderType();
      if (orderType === "random") filtered = shuffle(filtered);
      else if (orderType === "asc") filtered = filtered.sort((a,b)=>Number(a.num)-Number(b.num));
      else if (orderType === "desc") filtered = filtered.sort((a,b)=>Number(b.num)-Number(a.num));
      startPractice(filtered);
    }

    function startPractice(list) {
      wordList = list.slice();
      current = 0;
      wrongWords = [];
      correctCount = 0;
      wrongCount = 0;
      totalCount = wordList.length;
      updateStats();
      practiceSection.style.display = "";
      reviewSection.style.display = "none";
      rangeSection.style.display = "none";
      orderSection.style.display = "none";
      showWord();
    }

    function showWord() {
      if (current >= wordList.length) {
        finishPractice();
        return;
      }
      updateStats();
      wordProgress.textContent = `第 ${current + 1} / ${wordList.length} 題`;
      const en = wordList[current].en;
      const zh = wordList[current].zh;
      let hint = "";
      if (en.length >= 2) {
        hint = en[0] + "_".repeat(en.length-2) + en[en.length-1];
      } else if (en.length === 1) {
        hint = en;
      }
      wordQuestion.innerHTML = `
        請輸入「${zh}」的英文單字：
        <br>
        <span style="color:var(--accent-color);font-size:1.1em;font-weight:700;">
          提示：${hint}
        </span>
        <button class="pronounce-btn" id="pronounceBtn" title="發音">
          <svg viewBox="0 0 24 24">
            <path d="M3 10v4h4l5 5V5l-5 5H3zm13.5 2c0-1.77-1-3.29-2.5-4.03v8.05c1.5-.74 2.5-2.26 2.5-4.02zm2.5 0c0 3.04-1.64 5.64-4.5 6.32v2.02c4.01-.71 7-4.13 7-8.34s-2.99-7.63-7-8.34v2.02c2.86.68 4.5 3.28 4.5 6.32z"/>
          </svg>
        </button>
      `;
      answerInput.value = "";
      resultMsg.textContent = "";
      answerInput.focus();
      speakWord(en);
      setTimeout(() => {
        const btn = document.getElementById('pronounceBtn');
        if(btn) btn.onclick = () => speakWord(en);
      }, 10);
    }

    function speakWord(word) {
      if (!window.speechSynthesis) return;
      const utter = new SpeechSynthesisUtterance(word);
      utter.lang = 'en-US';
      const voices = window.speechSynthesis.getVoices();
      const enVoice = voices.find(v => v.lang && v.lang.startsWith('en'));
      if (enVoice) utter.voice = enVoice;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

    function checkAnswer() {
      const ans = answerInput.value.trim().toLowerCase();
      const correct = wordList[current].en.toLowerCase();
      if (ans === correct) {
        resultMsg.textContent = "答對了！";
        resultMsg.className = "result correct";
        correctCount++;
      } else {
        resultMsg.textContent = `答錯了，正確答案是：${wordList[current].en}`;
        resultMsg.className = "result incorrect";
        wrongWords.push(wordList[current]);
        wrongCount++;
      }
      updateStats();
      setTimeout(() => {
        current++;
        showWord();
      }, 2000);
    }

    function updateStats() {
      practiceStats.innerHTML = `
        <span>總題數: ${totalCount}</span>
        <span>正確: ${correctCount}</span>
        <span>錯誤: ${wrongCount}</span>
      `;
    }

    function finishPractice() {
      practiceSection.style.display = "none";
      if (wrongWords.length > 0) {
        reviewSection.style.display = "";
        wrongList.innerHTML = wrongWords.map(w => 
          `<li>${w.zh} ➔ <b>${w.en}</b></li>`
        ).join('');
        lastWrongWords = wrongWords.slice();
      } else {
        reviewSection.style.display = "";
        wrongList.innerHTML = "<li>恭喜全部答對！</li>";
        lastWrongWords = [];
      }
      setTimeout(() => {
        document.getElementById('exportWrongBtn').onclick = exportWrongCSV;
        document.getElementById('retryWrongBtn').onclick = retryWrongWords;
      }, 10);
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function exportWrongCSV() {
      if (!lastWrongWords || lastWrongWords.length === 0) {
        alert("沒有錯誤單字可匯出！");
        return;
      }
      let csv = '\uFEFF序號,英文單字,中文意思\n';
      lastWrongWords.forEach(w => {
        csv += `"${w.num}","${w.en}","${w.zh}"\n`;
      });
      const blob = new Blob([csv], {type: "text/csv;charset=utf-8;"});
      const now = new Date();
      const pad = n => n.toString().padStart(2, '0');
      const filename = `錯誤單字(${now.getFullYear()}${pad(now.getMonth()+1)}${pad(now.getDate())}-${pad(now.getHours())}${pad(now.getMinutes())}${pad(now.getSeconds())}).csv`;
      if (window.navigator.msSaveOrOpenBlob) {
        window.navigator.msSaveBlob(blob, filename);
      } else {
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    }

    function retryWrongWords() {
      if (!lastWrongWords || lastWrongWords.length === 0) {
        alert("沒有錯誤單字可重新練習！");
        return;
      }
      startPractice(shuffle(lastWrongWords));
    }

    answerInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') checkAnswer();
    });

    if ('speechSynthesis' in window) {
      window.speechSynthesis.onvoiceschanged = function() {};
    }

// 在 script 標籤內添加以下音效功能

// 音效系統
function createAudioContext() {
  return new (window.AudioContext || window.webkitAudioContext)();
}

let audioContext = null;

function initAudio() {
  if (!audioContext) {
    try {
      audioContext = createAudioContext();
    } catch (e) {
      console.log('Audio not supported');
    }
  }
}

// 播放正確答案音效（愉快的上升音調）
function playCorrectSound() {
  initAudio();
  if (!audioContext) return;
  
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  // 設定音調：C5 -> E5 -> G5 (大三和弦上行)
  oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
  oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
  oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
  
  // 音量淡入淡出
  gainNode.gain.setValueAtTime(0, audioContext.currentTime);
  gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.05);
  gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.25);
  gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.4);
  
  oscillator.type = 'sine';
  oscillator.start(audioContext.currentTime);
  oscillator.stop(audioContext.currentTime + 0.4);
}

// 播放錯誤答案音效（錯誤提示音）
function playIncorrectSound() {
  initAudio();
  if (!audioContext) return;
  
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  // 設定音調：重複的低音嗶嗶聲
  oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
  oscillator.frequency.setValueAtTime(200, audioContext.currentTime + 0.12);
  oscillator.frequency.setValueAtTime(200, audioContext.currentTime + 0.24);
  
  // 音量控制 - 三次短促的嗶聲
  gainNode.gain.setValueAtTime(0, audioContext.currentTime);
  gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.02);
  gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.08);
  gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.14);
  gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.2);
  gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.26);
  gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.32);
  
  oscillator.type = 'square';
  oscillator.start(audioContext.currentTime);
  oscillator.stop(audioContext.currentTime + 0.35);
}

// 修改 checkAnswer 函數，在原有的函數中添加音效
function checkAnswer() {
  const ans = answerInput.value.trim().toLowerCase();
  const correct = wordList[current].en.toLowerCase();
  if (ans === correct) {
    resultMsg.textContent = "答對了！";
    resultMsg.className = "result correct";
    correctCount++;
    playCorrectSound(); // 添加正確音效
  } else {
    resultMsg.textContent = `答錯了，正確答案是：${wordList[current].en}`;
    resultMsg.className = "result incorrect";
    wrongWords.push(wordList[current]);
    wrongCount++;
    playIncorrectSound(); // 添加錯誤音效
  }
  updateStats();
  setTimeout(() => {
    current++;
    showWord();
  }, 2000);
}
  </script>
</body>
</html>
